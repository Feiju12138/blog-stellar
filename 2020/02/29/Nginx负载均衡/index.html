<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ã€ç¬”è®°ã€‘Nginxè´Ÿè½½å‡è¡¡ | ç»¯é çš„åšå®¢ | è¿èœœç»Ÿæ²»ä¸–ç•Œ!!!ğŸ’•</title>

  
  <meta name="author" content="ç»¯é ">
  

  
  <meta name="description" content="æ•æ‰ä¸€åªçˆ±æŠ˜è…¾çš„ç»¯é ">
  

  
  
  <meta name="keywords" content="Nginx">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="ã€ç¬”è®°ã€‘Nginxè´Ÿè½½å‡è¡¡"/>

  <meta property="og:site_name" content="ç»¯é çš„åšå®¢"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="ç»¯é çš„åšå®¢" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">ç»¯é çš„åšå®¢</a>
    </h1>
    <p class="site-description">è¿èœœç»Ÿæ²»ä¸–ç•Œ!!!ğŸ’•</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">ä¸»é¡µ</a></li>
      
        <li><a href="/about/">å…³äº</a></li>
      
        <li><a href="/tags/">æ ‡ç­¾</a></li>
      
        <li><a href="/categories/">åˆ†ç±»</a></li>
      
        <li><a href="/archives/">å½’æ¡£</a></li>
      
        <li><a href="/links/">å‹é“¾</a></li>
      
        <li><a href="/reward/">èµåŠ©</a></li>
      
        <li><a href="/atom.xml">è®¢é˜…</a></li>
      
        <li><a target="_blank" rel="noopener" href="//stellar.loli.fj.cn">ä¸»é¢˜</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>ã€ç¬”è®°ã€‘Nginxè´Ÿè½½å‡è¡¡</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/02/29/Nginxè´Ÿè½½å‡è¡¡/" rel="bookmark">
        <time class="entry-date published" datetime="2020-02-29T01:42:33.000Z">
          2020-02-29
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸ºäº†æå‡åå°æœåŠ¡å™¨çš„å¤„ç†èƒ½åŠ›ï¼Œå¯ä»¥å¢åŠ æœåŠ¡å™¨.å®ç°è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ã€‚</p>
<span id="more"></span>

<h2 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h2><ul>
<li>å¼€å¯ä¸¤ä¸ªä¸åŒç«¯å£çš„æœåŠ¡</li>
</ul>
<h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><ul>
<li>åœ¨TomcatæœåŠ¡å™¨åˆ›å»º<code>/edu/a.html</code>ç½‘é¡µæ–‡ä»¶</li>
</ul>
<p><img src="/images/20200229094233/01.webp"></p>
<h3 id="Apache"><a href="#Apache" class="headerlink" title="Apache"></a>Apache</h3><ul>
<li>åœ¨ApacheæœåŠ¡å™¨åˆ›å»º<code>/edu/a.html</code>ç½‘é¡µæ–‡ä»¶</li>
</ul>
<p><img src="/images/20200229094233/02.webp"></p>
<ul>
<li>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†ç«¯å£å·æ”¹ä¸º<code>8081</code></li>
</ul>
<h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><ul>
<li><p>å¯åŠ¨<code>Tomcat</code>å’Œ<code>Apache</code>å¹¶æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ</p>
</li>
<li><p>å¯åŠ¨<code>Nginx</code>å¹¶æŸ¥çœ‹ç«¯å£å ç”¨æƒ…å†µ</p>
</li>
</ul>
<p><img src="/images/20200229094233/03.webp"></p>
<h2 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h2><h3 id="http-å—"><a href="#http-å—" class="headerlink" title="http å—"></a>http å—</h3><ul>
<li>æ·»åŠ ä¸€ä¸ª<code>upstreamå—</code>ï¼Œè‡ªå®šä¹‰åç§°</li>
</ul>
<figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream myserver &#123;</span><br><span class="line">    server 127.0.0.1:8080 weight=1;</span><br><span class="line">    server 127.0.0.1:8081 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="server-å—"><a href="#server-å—" class="headerlink" title="server å—"></a>server å—</h3><figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">listen 80;</span><br><span class="line">server_name 127.0.0.1;</span><br></pre></td></tr></table></figure>

<h3 id="location-å—"><a href="#location-å—" class="headerlink" title="location å—"></a>location å—</h3><ul>
<li>å¢åŠ <code>proxy_pass</code>ï¼Œå€¼ä¸ºåˆšåˆ›å»ºçš„<code>upstreamå—å</code>ï¼Œå¢åŠ <code>proxy_connect_timeout</code>ï¼Œè¶…æ—¶æ—¶é—´</li>
</ul>
<figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    ...</span><br><span class="line">    proxy_pass http://myserver;</span><br><span class="line">    proxy_connect_timeout 10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Nginxåˆ†é…æœåŠ¡å™¨ç­–ç•¥"><a href="#Nginxåˆ†é…æœåŠ¡å™¨ç­–ç•¥" class="headerlink" title="Nginxåˆ†é…æœåŠ¡å™¨ç­–ç•¥"></a>Nginxåˆ†é…æœåŠ¡å™¨ç­–ç•¥</h2><h3 id="è½®è¯¢ï¼ˆé»˜è®¤ï¼‰"><a href="#è½®è¯¢ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="è½®è¯¢ï¼ˆé»˜è®¤ï¼‰"></a>è½®è¯¢ï¼ˆé»˜è®¤ï¼‰</h3><ul>
<li>æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤</li>
</ul>
<h3 id="æƒé‡"><a href="#æƒé‡" class="headerlink" title="æƒé‡"></a>æƒé‡</h3><ul>
<li>weightä»£è¡¨æƒé‡ï¼Œé»˜è®¤ä¸º1ï¼Œæƒé‡è¶Šé«˜è¢«åˆ†é…çš„å®¢æˆ·ç«¯è¶Šå¤š</li>
</ul>
<figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream server_pool &#123;</span><br><span class="line">    server 127.0.0.1:8080 weight=1;</span><br><span class="line">    server 127.0.0.1:8081 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ip-hash"><a href="#ip-hash" class="headerlink" title="ip_hash"></a>ip_hash</h3><ul>
<li>æ¯ä¸ªè¯·æ±‚è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³seccioné—®é¢˜</li>
</ul>
<figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream server_pool &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    server 127.0.0.1:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é£é™©"><a href="#é£é™©" class="headerlink" title="é£é™©"></a>é£é™©</h4><ul>
<li>ç”±äºIPè¿›è¡Œhashè®¡ç®—ï¼Œåˆ™å¯èƒ½å‡ºç°å¤šä¸ªç”¨æˆ·åŒæ—¶ç»‘å®šä¸€å°æœåŠ¡å™¨çš„æ•ˆæœï¼Œå¯¼è‡´è´Ÿè½½ä¸å‡è¡¡</li>
<li>å¦‚æœç»‘å®šåŒä¸€å°æœåŠ¡å™¨ï¼Œå¦‚æœè¿™å°æœåŠ¡å™¨å®•æœºï¼Œåˆ™ç›´æ¥å½±å“ç”¨æˆ·ä½¿ç”¨</li>
</ul>
<h3 id="fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰"><a href="#fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰" class="headerlink" title="fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰"></a>fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰</h3><ul>
<li>æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…</li>
</ul>
<figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream server_pool &#123;</span><br><span class="line">    server 127.0.0.1:8080;</span><br><span class="line">    server 127.0.0.1:8081;</span><br><span class="line">    fair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å…¶ä»–å±æ€§"><a href="#å…¶ä»–å±æ€§" class="headerlink" title="å…¶ä»–å±æ€§"></a>å…¶ä»–å±æ€§</h2><h3 id="é…ç½®å…³é—­æœåŠ¡å™¨"><a href="#é…ç½®å…³é—­æœåŠ¡å™¨" class="headerlink" title="é…ç½®å…³é—­æœåŠ¡å™¨"></a>é…ç½®å…³é—­æœåŠ¡å™¨</h3><blockquote>
<p><code>down</code>ï¼šå…³é—­æœåŠ¡å™¨</p>
</blockquote>
<figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream server_pool &#123;</span><br><span class="line">    server 127.0.0.1:8080 down;</span><br><span class="line">    server 127.0.0.1:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®å¤‡ç”¨æœº"><a href="#é…ç½®å¤‡ç”¨æœº" class="headerlink" title="é…ç½®å¤‡ç”¨æœº"></a>é…ç½®å¤‡ç”¨æœº</h3><ul>
<li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œè¯¥æœåŠ¡å™¨ä¸ä¼šä¸ºç”¨æˆ·æä¾›æœåŠ¡ã€‚ä½†æ˜¯å½“æœåŠ¡å™¨å®•æœºï¼Œæˆ–è€…æœåŠ¡å™¨æ­£å¿™æ—¶ï¼Œæ‰ä¼šè®¿é—®è¯¥æœåŠ¡å™¨ã€‚</li>
</ul>
<blockquote>
<p><code>bachup</code>ï¼šè¡¨ç¤ºå¤‡ç”¨æœº</p>
</blockquote>
<figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream server_pool &#123;</span><br><span class="line">    server 127.0.0.1:8080 backup;</span><br><span class="line">    server 127.0.0.1:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="é…ç½®é«˜å¯ç”¨"><a href="#é…ç½®é«˜å¯ç”¨" class="headerlink" title="é…ç½®é«˜å¯ç”¨"></a>é…ç½®é«˜å¯ç”¨</h3><ul>
<li>å½“æœåŠ¡å™¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œé€šè¿‡æŸç§æœºåˆ¶å¯ä»¥è‡ªåŠ¨çš„å®ç°æ•…éšœçš„è¿ç§»ï¼Œä»è€Œä½¿å¾—ç”¨æˆ·ä¸å—ä»»ä½•çš„å½±å“ã€‚</li>
</ul>
<blockquote>
<p><code>max_fails</code>ï¼šæœ€å¤§å¤±è´¥æ¬¡æ•°<br><code>fail_timeout</code>ï¼šå¦‚æœè®¿é—®ä¸é€šï¼Œ60sä¹‹å†…ï¼Œä¸ä¼šå†æ¬¡è®¿é—®æ•…éšœæœº</p>
</blockquote>
<figure class="highlight text"><figcaption><span>/usr/local/etc/nginx/nginx.conf</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream server_pool &#123;</span><br><span class="line">    server 127.0.0.1:8080 max_fails=1 fail_timeout=60s;</span><br><span class="line">    server 127.0.0.1:8081;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®Œæˆ"><a href="#å®Œæˆ" class="headerlink" title="å®Œæˆ"></a>å®Œæˆ</h2><ul>
<li>æˆªå›¾çºªå¿µ</li>
</ul>
<p><img src="/images/20200229094233/04.gif"></p>
<p><img src="/images/20200229094233/05.gif"></p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p><a href="/302.html?target=https://www.bilibili.com/video/av68136734">å“”å“©å“”å“©â€”â€”å°šç¡…è°·å®˜æ–¹</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Nginx/">Nginx</a>
    </span>
    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 ç»¯é 
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>