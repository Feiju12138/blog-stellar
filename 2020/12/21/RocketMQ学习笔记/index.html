<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ã€ç¬”è®°ã€‘RocketMQå­¦ä¹ ç¬”è®° | ç»¯é çš„åšå®¢ | è¿èœœç»Ÿæ²»ä¸–ç•Œ!!!ğŸ’•</title>

  
  <meta name="author" content="ç»¯é ">
  

  
  <meta name="description" content="æ•æ‰ä¸€åªçˆ±æŠ˜è…¾çš„ç»¯é ">
  

  
  
  <meta name="keywords" content="Java,MessageQueue">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="ã€ç¬”è®°ã€‘RocketMQå­¦ä¹ ç¬”è®°"/>

  <meta property="og:site_name" content="ç»¯é çš„åšå®¢"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="ç»¯é çš„åšå®¢" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">ç»¯é çš„åšå®¢</a>
    </h1>
    <p class="site-description">è¿èœœç»Ÿæ²»ä¸–ç•Œ!!!ğŸ’•</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">ä¸»é¡µ</a></li>
      
        <li><a href="/about/">å…³äº</a></li>
      
        <li><a href="/tags/">æ ‡ç­¾</a></li>
      
        <li><a href="/categories/">åˆ†ç±»</a></li>
      
        <li><a href="/archives/">å½’æ¡£</a></li>
      
        <li><a href="/links/">å‹é“¾</a></li>
      
        <li><a href="/reward/">èµåŠ©</a></li>
      
        <li><a href="/atom.xml">è®¢é˜…</a></li>
      
        <li><a target="_blank" rel="noopener" href="//stellar.loli.fj.cn">ä¸»é¢˜</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>ã€ç¬”è®°ã€‘RocketMQå­¦ä¹ ç¬”è®°</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/12/21/RocketMQå­¦ä¹ ç¬”è®°/" rel="bookmark">
        <time class="entry-date published" datetime="2020-12-21T01:51:32.000Z">
          2020-12-21
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>RocketMQå­¦ä¹ ç¬”è®°</p>
<span id="more"></span>

<h2 id="åŒæ­¥æ¨¡å¼"><a href="#åŒæ­¥æ¨¡å¼" class="headerlink" title="åŒæ­¥æ¨¡å¼"></a>åŒæ­¥æ¨¡å¼</h2><h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡ï¼Œå¹¶æŒ‡å®šç”Ÿäº§è€…ç»„</span></span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;producerGroup1&quot;</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">        p.setNamesrvAddr(<span class="string">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨ç”Ÿäº§è€…</span></span><br><span class="line">        p.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘æ¶ˆæ¯æœåŠ¡å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(</span><br><span class="line">                <span class="string">&quot;Topic1&quot;</span>, <span class="comment">// æŒ‡å®šå‘é€çš„ä¸»é¢˜ï¼Œç›¸å½“äºä¸€çº§åˆ†ç±»</span></span><br><span class="line">                <span class="string">&quot;TagA&quot;</span>, <span class="comment">// ä»»æ„æŒ‡å®šæ¶ˆæ¯çš„æ ‡ç­¾ï¼Œç›¸å½“äºäºŒçº§åˆ†ç±»ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">                <span class="string">&quot;Hello World !&quot;</span>.getBytes() <span class="comment">// æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">        );</span><br><span class="line">        <span class="type">SendResult</span> <span class="variable">r</span> <span class="operator">=</span> p.send(msg);</span><br><span class="line">        System.out.println(r);</span><br><span class="line"></span><br><span class="line">        p.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ¶ˆè´¹è€…å¯¹è±¡ï¼Œå¹¶æŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * DefaultMQPushConsumerï¼šæœåŠ¡å™¨ä¸»åŠ¨å‘æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * DefaultMQPullConsumerï¼šæ¶ˆè´¹è€…ä¸»åŠ¨å‘æœåŠ¡å™¨è¯·æ±‚æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">DefaultMQPushConsumer</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQPushConsumer</span>(<span class="string">&quot;consumerGroup1&quot;</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ¶ˆè´¹è€…ä¸­å¿ƒ</span></span><br><span class="line">        c.setNamesrvAddr(<span class="string">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class="line">        <span class="comment">// ä»æŒ‡å®šçš„Topicè®¢é˜…æ¶ˆæ¯</span></span><br><span class="line">        c.subscribe(</span><br><span class="line">                <span class="string">&quot;Topic1&quot;</span>, <span class="comment">// æŒ‡å®šè®¢é˜…çš„ä¸»é¢˜</span></span><br><span class="line">                <span class="string">&quot;TagA || TagB&quot;</span> <span class="comment">// æŒ‡å®šæ ‡ç­¾ï¼Œå¤šä¸ªè¡¨é’±ç”¨`||`åˆ†éš”</span></span><br><span class="line">        );</span><br><span class="line">        <span class="comment">// æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨</span></span><br><span class="line">        c.registerMessageListener(<span class="keyword">new</span> <span class="title class_">MessageListenerConcurrently</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title function_">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (MessageExt ext : list) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(ext.getBody());</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ”¶åˆ°ï¼š&quot;</span>+msg);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¤„ç†æˆåŠŸçš„è¿”å›å€¼</span></span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">                <span class="comment">// å¤„ç†å¤±è´¥çš„è¿”å›å€¼</span></span><br><span class="line">                <span class="comment">// return ConsumeConcurrentlyStatus.RECONSUME_LATER;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// å¯åŠ¨æ¶ˆè´¹è€…</span></span><br><span class="line">        c.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…å¼€å§‹æ¶ˆè´¹æ•°æ®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å»¶è¿Ÿæ¶ˆæ¯"><a href="#å»¶è¿Ÿæ¶ˆæ¯" class="headerlink" title="å»¶è¿Ÿæ¶ˆæ¯"></a>å»¶è¿Ÿæ¶ˆæ¯</h2><h3 id="å»¶è¿Ÿçº§åˆ«"><a href="#å»¶è¿Ÿçº§åˆ«" class="headerlink" title="å»¶è¿Ÿçº§åˆ«"></a>å»¶è¿Ÿçº§åˆ«</h3><table>
<thead>
<tr>
<th>å»¶è¿Ÿçº§åˆ«</th>
<th>å®é™…å»¶è¿Ÿæ—¶é—´</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1s</td>
</tr>
<tr>
<td>2</td>
<td>5s</td>
</tr>
<tr>
<td>3</td>
<td>10s</td>
</tr>
<tr>
<td>4</td>
<td>30s</td>
</tr>
<tr>
<td>5</td>
<td>1m</td>
</tr>
<tr>
<td>6</td>
<td>2m</td>
</tr>
<tr>
<td>7</td>
<td>3m</td>
</tr>
<tr>
<td>8</td>
<td>4m</td>
</tr>
<tr>
<td>9</td>
<td>5m</td>
</tr>
<tr>
<td>10</td>
<td>6m</td>
</tr>
<tr>
<td>11</td>
<td>7m</td>
</tr>
<tr>
<td>12</td>
<td>8m</td>
</tr>
<tr>
<td>13</td>
<td>9m</td>
</tr>
<tr>
<td>14</td>
<td>10m</td>
</tr>
<tr>
<td>15</td>
<td>20m</td>
</tr>
<tr>
<td>16</td>
<td>30m</td>
</tr>
<tr>
<td>17</td>
<td>1h</td>
</tr>
<tr>
<td>18</td>
<td>2h</td>
</tr>
</tbody></table>
<h3 id="ç”Ÿäº§è€…-1"><a href="#ç”Ÿäº§è€…-1" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡ï¼Œå¹¶æŒ‡å®šç”Ÿäº§è€…ç»„</span></span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;producerGroup1&quot;</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">        p.setNamesrvAddr(<span class="string">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨ç”Ÿäº§è€…</span></span><br><span class="line">        p.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘æ¶ˆæ¯æœåŠ¡å‘é€æ¶ˆæ¯</span></span><br><span class="line">        <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;Topic1&quot;</span>, <span class="string">&quot;TagA&quot;</span>, <span class="string">&quot;Hello World !&quot;</span>.getBytes());</span><br><span class="line">        <span class="comment">// æŒ‡å®šå»¶è¿Ÿçº§åˆ«</span></span><br><span class="line">        msg.setDelayTimeLevel(<span class="number">3</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">SendResult</span> <span class="variable">r</span> <span class="operator">=</span> p.send(msg);</span><br><span class="line">        System.out.println(r);</span><br><span class="line"></span><br><span class="line">        p.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¶ˆè´¹è€…-1"><a href="#æ¶ˆè´¹è€…-1" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><ul>
<li>ä¸åŒæ­¥æ¨¡å¼ç›¸åŒ</li>
</ul>
<h2 id="é¡ºåºæ¨¡å¼"><a href="#é¡ºåºæ¨¡å¼" class="headerlink" title="é¡ºåºæ¨¡å¼"></a>é¡ºåºæ¨¡å¼</h2><h3 id="ç”Ÿäº§è€…-2"><a href="#ç”Ÿäº§è€…-2" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> String[] msgs = &#123;</span><br><span class="line">            <span class="string">&quot;15103111039,åˆ›å»º&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103111065,åˆ›å»º&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103111039,ä»˜æ¬¾&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103117235,åˆ›å»º&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103111065,ä»˜æ¬¾&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103117235,ä»˜æ¬¾&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103111065,å®Œæˆ&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103111039,æ¨é€&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103117235,å®Œæˆ&quot;</span>,</span><br><span class="line">            <span class="string">&quot;15103111039,å®Œæˆ&quot;</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºç”Ÿäº§è€…å¯¹è±¡ï¼Œå¹¶æŒ‡å®šç”Ÿäº§è€…ç»„</span></span><br><span class="line">        <span class="type">DefaultMQProducer</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(<span class="string">&quot;producerGroup1&quot;</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">        p.setNamesrvAddr(<span class="string">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class="line">        <span class="comment">// å¯åŠ¨ç”Ÿäº§è€…</span></span><br><span class="line">        p.start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é¡ºåºå‘é€æ‰€æœ‰æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šé˜Ÿåˆ—é€‰æ‹©å™¨</span></span><br><span class="line">        <span class="keyword">for</span> (String s : msgs) &#123;</span><br><span class="line">            String[] arr = s.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> Long.parseLong(arr[<span class="number">0</span>]);</span><br><span class="line">            <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;Topic2&quot;</span>, <span class="string">&quot;TagA&quot;</span>, s.getBytes());</span><br><span class="line"></span><br><span class="line">            <span class="type">SendResult</span> <span class="variable">r</span> <span class="operator">=</span> p.send(</span><br><span class="line">                    msg, <span class="comment">// æ¶ˆæ¯å†…å®¹</span></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">MessageQueueSelector</span>() &#123;</span><br><span class="line">                        <span class="comment">// é€šè¿‡`idå¯¹æ¶ˆè´¹è€…æ•°é‡å–ä½™ä½œä¸ºæ¶ˆè´¹è€…çš„ä¸‹æ ‡`æ¥åˆ¤å®šå‘é€åˆ°å“ªä¸ªæ¶ˆè´¹è€…</span></span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">public</span> MessageQueue <span class="title function_">select</span><span class="params">(List&lt;MessageQueue&gt; list, Message message, Object o <span class="comment">/*é€‰æ‹©ä¾æ®*/</span>)</span> &#123;</span><br><span class="line">                            <span class="type">long</span> <span class="variable">orderId</span> <span class="operator">=</span> (<span class="type">long</span>) o;</span><br><span class="line">                            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (<span class="type">int</span>) orderId % list.size();</span><br><span class="line">                            <span class="keyword">return</span> list.get(index);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="comment">// é€‰æ‹©å™¨</span></span><br><span class="line">                    orderId <span class="comment">// é€‰æ‹©ä¾æ®</span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            System.out.println(r);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        p.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¶ˆè´¹è€…-2"><a href="#æ¶ˆè´¹è€…-2" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MQClientException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ¶ˆè´¹è€…è¿æ¥æ³¨å†Œä¸­å¿ƒ</span></span><br><span class="line">        <span class="type">DefaultMQPushConsumer</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQPushConsumer</span>(<span class="string">&quot;consumerGroup2&quot;</span>);</span><br><span class="line">        c.setNamesrvAddr(<span class="string">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¢é˜…æ¶ˆæ¯</span></span><br><span class="line">        c.subscribe(</span><br><span class="line">                <span class="string">&quot;Topic2&quot;</span>,</span><br><span class="line">                <span class="string">&quot;*&quot;</span> <span class="comment">// æ‰€æœ‰æ ‡ç­¾</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ³¨å†Œé¡ºåºæ¶ˆæ¯ç›‘å¬å™¨</span></span><br><span class="line">        c.registerMessageListener(<span class="keyword">new</span> <span class="title class_">MessageListenerOrderly</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> ConsumeOrderlyStatus <span class="title function_">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeOrderlyContext consumeOrderlyContext)</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (MessageExt ext : list) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(ext.getBody());</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ”¶åˆ°ï¼š&quot;</span>+msg);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ConsumeOrderlyStatus.SUCCESS;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        c.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…å¼€å§‹æ¥æ”¶æ¶ˆæ¯&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äº‹åŠ¡æ¶ˆæ¯"><a href="#äº‹åŠ¡æ¶ˆæ¯" class="headerlink" title="äº‹åŠ¡æ¶ˆæ¯"></a>äº‹åŠ¡æ¶ˆæ¯</h2><h3 id="ç”Ÿäº§è€…-3"><a href="#ç”Ÿäº§è€…-3" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> MQClientException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºäº‹åŠ¡æ¶ˆæ¯ç”Ÿäº§è€…å¯¹è±¡</span></span><br><span class="line">        <span class="type">TransactionMQProducer</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TransactionMQProducer</span>(<span class="string">&quot;producerGroup3&quot;</span>);</span><br><span class="line">        <span class="comment">// è¿æ¥æ³¨å†Œä¸­å¿ƒå¹¶å¯åŠ¨</span></span><br><span class="line">        p.setNamesrvAddr(<span class="string">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class="line">        p.start();</span><br><span class="line">        <span class="comment">// æ³¨å†Œäº‹åŠ¡æ¶ˆæ¯ç›‘å¬å™¨ï¼Œç›‘å¬å™¨å®ç°ä¸¤ä¸ªåŠŸèƒ½</span></span><br><span class="line">        p.setTransactionListener(<span class="keyword">new</span> <span class="title class_">TransactionListener</span>() &#123;</span><br><span class="line"></span><br><span class="line">            Map&lt;String, LocalTransactionState&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 1ã€æ‰§è¡Œæœ¬åœ°äº‹åŠ¡</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> LocalTransactionState <span class="title function_">executeLocalTransaction</span><span class="params">(Message message, Object o)</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (Math.random() &lt; <span class="number">0.5</span><span class="comment">/*æ¨¡æ‹Ÿå›æŸ¥*/</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒçŠ¶æ€æœªçŸ¥&quot;</span>);</span><br><span class="line">                    map.put(message.getTransactionId(), LocalTransactionState.UNKNOW);</span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.UNKNOW;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                System.out.println(<span class="string">&quot;æ‰§è¡Œæœ¬åœ°äº‹åŠ¡&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span> (Math.random() &lt; <span class="number">0.5</span><span class="comment">/*æ¨¡æ‹Ÿäº‹åŠ¡æ‰§è¡ŒçŠ¶æ€*/</span>) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æœ¬åœ°äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ&quot;</span>);</span><br><span class="line">                    map.put(message.getTransactionId(), LocalTransactionState.COMMIT_MESSAGE);</span><br><span class="line">                    <span class="comment">// æäº¤æ¶ˆæ¯</span></span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.COMMIT_MESSAGE;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;æœ¬åœ°äº‹åŠ¡æ‰§è¡Œå¤±è´¥&quot;</span>);</span><br><span class="line">                    map.put(message.getTransactionId(), LocalTransactionState.ROLLBACK_MESSAGE);</span><br><span class="line">                    <span class="comment">// å›æ»šæ¶ˆæ¯</span></span><br><span class="line">                    <span class="keyword">return</span> LocalTransactionState.ROLLBACK_MESSAGE;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2ã€å¤„ç†äº‹åŠ¡å›æŸ¥</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> LocalTransactionState <span class="title function_">checkLocalTransaction</span><span class="params">(MessageExt messageExt)</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;æœåŠ¡å™¨æ­£åœ¨å›æŸ¥äº‹åŠ¡çŠ¶æ€&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> map.get(messageExt.getTransactionId());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¾ªç¯å‘é€äº‹åŠ¡æ¶ˆæ¯ï¼Œå‘é€äº‹åŠ¡æ¶ˆæ¯ä¼šå‡ºå‘ç›‘å¬å™¨æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;è¾“å…¥æ¶ˆæ¯ï¼š&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in).nextLine();</span><br><span class="line">            <span class="type">Message</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(<span class="string">&quot;topic3&quot;</span>, s.getBytes());</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;å‘é€äº‹åŠ¡æ¶ˆæ¯&quot;</span>);</span><br><span class="line"></span><br><span class="line">            p.sendMessageInTransaction(</span><br><span class="line">                    msg,</span><br><span class="line">                    <span class="literal">null</span> <span class="comment">// ä¸šåŠ¡æ•°æ®ï¼Œä¼šè¢«ä¼ é€’åˆ°ç›‘å¬å™¨æ‰§è¡Œæœ¬åœ°äº‹åŠ¡çš„æ–¹æ³•ä¸­</span></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;äº‹åŠ¡æ¶ˆæ¯å¤„ç†ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ¶ˆè´¹è€…-3"><a href="#æ¶ˆè´¹è€…-3" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ¶ˆè´¹è€…å¯¹è±¡ï¼Œå¹¶æŒ‡å®šæ¶ˆè´¹è€…ç»„</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * DefaultMQPushConsumerï¼šæœåŠ¡å™¨ä¸»åŠ¨å‘æ¶ˆè´¹è€…æ¨é€æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         * DefaultMQPullConsumerï¼šæ¶ˆè´¹è€…ä¸»åŠ¨å‘æœåŠ¡å™¨è¯·æ±‚æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">DefaultMQPushConsumer</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQPushConsumer</span>(<span class="string">&quot;consumerGroup3&quot;</span>);</span><br><span class="line">        <span class="comment">// æŒ‡å®šæ¶ˆè´¹è€…ä¸­å¿ƒ</span></span><br><span class="line">        c.setNamesrvAddr(<span class="string">&quot;127.0.0.1:9876&quot;</span>);</span><br><span class="line">        <span class="comment">// ä»æŒ‡å®šçš„Topicè®¢é˜…æ¶ˆæ¯</span></span><br><span class="line">        c.subscribe(<span class="string">&quot;Topic1&quot;</span>, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// æ³¨å†Œæ¶ˆæ¯ç›‘å¬å™¨</span></span><br><span class="line">        c.registerMessageListener(<span class="keyword">new</span> <span class="title class_">MessageListenerConcurrently</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> ConsumeConcurrentlyStatus <span class="title function_">consumeMessage</span><span class="params">(List&lt;MessageExt&gt; list, ConsumeConcurrentlyContext consumeConcurrentlyContext)</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (MessageExt ext : list) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(ext.getBody());</span><br><span class="line">                    System.out.println(<span class="string">&quot;æ”¶åˆ°ï¼š&quot;</span>+msg);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¤„ç†æˆåŠŸçš„è¿”å›å€¼</span></span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">                <span class="comment">// å¤„ç†å¤±è´¥çš„è¿”å›å€¼</span></span><br><span class="line">                <span class="comment">// return ConsumeConcurrentlyStatus.RECONSUME_LATER;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// å¯åŠ¨æ¶ˆè´¹è€…</span></span><br><span class="line">        c.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆè´¹è€…å¼€å§‹æ¶ˆè´¹æ•°æ®&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®Œæˆ"><a href="#å®Œæˆ" class="headerlink" title="å®Œæˆ"></a>å®Œæˆ</h2>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/Javaåç«¯å­¦ä¹ æŒ‡åŒ—/">Javaåç«¯å­¦ä¹ æŒ‡åŒ—</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Java/">Java</a><a href="/tags/MessageQueue/">MessageQueue</a>
    </span>
    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 ç»¯é 
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>