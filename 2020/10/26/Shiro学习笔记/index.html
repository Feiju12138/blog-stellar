<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ã€ç¬”è®°ã€‘Shiroå­¦ä¹ ç¬”è®° | ç»¯é çš„åšå®¢ | è¿èœœç»Ÿæ²»ä¸–ç•Œ!!!ğŸ’•</title>

  
  <meta name="author" content="ç»¯é ">
  

  
  <meta name="description" content="æ•æ‰ä¸€åªçˆ±æŠ˜è…¾çš„ç»¯é ">
  

  
  
  <meta name="keywords" content="Java">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  <meta property="og:title" content="ã€ç¬”è®°ã€‘Shiroå­¦ä¹ ç¬”è®°"/>

  <meta property="og:site_name" content="ç»¯é çš„åšå®¢"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="ç»¯é çš„åšå®¢" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">ç»¯é çš„åšå®¢</a>
    </h1>
    <p class="site-description">è¿èœœç»Ÿæ²»ä¸–ç•Œ!!!ğŸ’•</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">ä¸»é¡µ</a></li>
      
        <li><a href="/about/">å…³äº</a></li>
      
        <li><a href="/tags/">æ ‡ç­¾</a></li>
      
        <li><a href="/categories/">åˆ†ç±»</a></li>
      
        <li><a href="/archives/">å½’æ¡£</a></li>
      
        <li><a href="/links/">å‹é“¾</a></li>
      
        <li><a href="/reward/">èµåŠ©</a></li>
      
        <li><a href="/atom.xml">è®¢é˜…</a></li>
      
        <li><a target="_blank" rel="noopener" href="//stellar.loli.fj.cn">ä¸»é¢˜</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    <article>

  
    
    <h3 class="article-title"><span>ã€ç¬”è®°ã€‘Shiroå­¦ä¹ ç¬”è®°</span></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/10/26/Shiroå­¦ä¹ ç¬”è®°/" rel="bookmark">
        <time class="entry-date published" datetime="2020-10-26T11:54:09.000Z">
          2020-10-26
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Shiroæ¡†æ¶å­¦ä¹ ç¬”è®°</p>
<span id="more"></span>

<h2 id="æ·»åŠ ä¾èµ–"><a href="#æ·»åŠ ä¾èµ–" class="headerlink" title="æ·»åŠ ä¾èµ–"></a>æ·»åŠ ä¾èµ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.6</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="Shiroé…ç½®ç±»"><a href="#Shiroé…ç½®ç±»" class="headerlink" title="Shiroé…ç½®ç±»"></a>Shiroé…ç½®ç±»</h2><ul>
<li><p>ä¹Ÿå¯ä»¥åœ¨é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®</p>
</li>
<li><p>æ–°å»ºä¸€ä¸ªç±»ä½œä¸ºShiroçš„é…ç½®ç±»ï¼Œå¹¶ç”±<code>@Configuration</code>æ³¨è§£æ ‡æ³¨</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringShiroConfig</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Shiroæ ¸å¿ƒé…ç½®å¯¹è±¡"><a href="#Shiroæ ¸å¿ƒé…ç½®å¯¹è±¡" class="headerlink" title="Shiroæ ¸å¿ƒé…ç½®å¯¹è±¡"></a>Shiroæ ¸å¿ƒé…ç½®å¯¹è±¡</h2><ul>
<li>åœ¨é…ç½®ç±»ä¸­åˆ›å»ºé…ç½®Shiroæ ¸å¿ƒå¯¹è±¡çš„æ–¹æ³•ï¼Œå¹¶äº¤ç»™Springç®¡ç†</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">()</span>&#123;</span><br><span class="line">    DefaultWebSecurityManager securityManager=<span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">    <span class="keyword">return</span> securityManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Shiroè®¿é—®è§„åˆ™é…ç½®"><a href="#Shiroè®¿é—®è§„åˆ™é…ç½®" class="headerlink" title="Shiroè®¿é—®è§„åˆ™é…ç½®"></a>Shiroè®¿é—®è§„åˆ™é…ç½®</h2><ul>
<li>åœ¨é…ç½®ç±»ä¸­åˆ›å»ºé…ç½®Shiroè®¿é—®è§„åˆ™çš„æ–¹æ³•ï¼Œé…ç½®åŒ¿åè®¿é—®çš„èµ„æºå’Œè®¤è¯çš„è®¿é—®çš„èµ„æºï¼Œå¹¶äº¤ç»™Springç®¡ç†</li>
</ul>
<blockquote>
<p>Shiroä¸­é»˜è®¤è¿‡æ»¤å™¨</p>
<blockquote>
<p><code>anon</code>ï¼šå…è®¸åŒ¿åè®¿é—®<br><code>authc</code>ï¼šéœ€è¦è®¤è¯åè®¿é—®<br><code>logout</code>ï¼šé€€å‡ºè¿‡æ»¤å™¨ï¼Œä¸€æ—¦æ‰§è¡Œäº†é€€å‡ºæ“ä½œï¼Œåº•å±‚ä¼šå°†ç³»ç»ŸæœåŠ¡ç«¯å­˜å‚¨çš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œæ¸…é™¤å¹¶ä¸”ç›´æ¥è·³è½¬åˆ°ç™»å½•é¡µé¢</p>
</blockquote>
</blockquote>
<blockquote>
<p><code>**</code>ï¼šè¡¨ç¤ºå½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶åŠå…¶æ‰€æœ‰å­ç›®å½•</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactory</span><span class="params">( SecurityManager securityManager)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">ShiroFilterFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">    <span class="comment">// securityManagerå¯¹è±¡è´Ÿè´£å»æ£€æµ‹è¿™ä¸ªè¯·æ±‚æ˜¯å¦å·²ç»è®¤è¯</span></span><br><span class="line">    factoryBean.setSecurityManager(securityManager);</span><br><span class="line">    <span class="comment">// é…ç½®ç™»å½•é¡µé¢çš„è®¿é—®è·¯å¾„</span></span><br><span class="line">    factoryBean.setLoginUrl(<span class="string">&quot;/doLoginUI&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Map&lt;String,String&gt; filterMap=<span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// é…ç½®å…è®¸åŒ¿åè®¿é—®çš„èµ„æºï¼ˆé€šå¸¸ä¸ºæ‰€æœ‰çš„é™æ€èµ„æºï¼‰</span></span><br><span class="line">    filterMap.put(<span class="string">&quot;/build/**&quot;</span>,<span class="string">&quot;anon&quot;</span>);</span><br><span class="line">    <span class="comment">// é…ç½®ç™»å½•</span></span><br><span class="line">    filterMap.put(<span class="string">&quot;/user/doLogin&quot;</span>,<span class="string">&quot;anon&quot;</span>);</span><br><span class="line">    <span class="comment">// é…ç½®é€€å‡º</span></span><br><span class="line">    filterMap.put(<span class="string">&quot;/doLogout&quot;</span>,<span class="string">&quot;logout&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// é™¤äº†åŒ¿åè®¿é—®çš„èµ„æº,å…¶å®ƒéƒ½è¦è®¤è¯åè®¿é—®</span></span><br><span class="line">    filterMap.put(<span class="string">&quot;/**&quot;</span>,<span class="string">&quot;authc&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    factoryBean.setFilterChainDefinitionMap(filterMap);<span class="comment">//è¿‡æ»¤é“¾çš„å®šä¹‰</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> factoryBean;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°è®¤è¯"><a href="#å®ç°è®¤è¯" class="headerlink" title="å®ç°è®¤è¯"></a>å®ç°è®¤è¯</h2><h3 id="åˆ›å»ºRealmç±»"><a href="#åˆ›å»ºRealmç±»" class="headerlink" title="åˆ›å»ºRealmç±»"></a>åˆ›å»ºRealmç±»</h3><ul>
<li>åœ¨<code>service.impl</code>åŒ…ä¸‹åˆ›å»ºä¸€ä¸ªRealmç±»ï¼Œç»§æ‰¿AuthorizingRealmç±»å¹¶é‡å†™æŠ½è±¡æ–¹æ³•ï¼Œä¸ºè¿™ä¸ªç±»æ ‡æ³¨<code>@Component</code>æ³¨è§£å®šä¹‰ä¸ºç»„å»ºäº¤ç»™Springç®¡ç†</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroUserRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–å¹¶å°è£…æˆæƒä¿¡æ¯ï¼ˆåšæˆæƒä¸šåŠ¡æ—¶å†™æ­¤æ–¹æ³•ï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–å¹¶å°è£…è®¤è¯ä¿¡æ¯</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken authenticationToken)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line">        <span class="comment">// è·å–ç™»å½•æ—¶è¾“å…¥çš„ç”¨æˆ·å</span></span><br><span class="line">        <span class="type">UsernamePasswordToken</span> <span class="variable">uToken</span> <span class="operator">=</span> (UsernamePasswordToken) authenticationToken;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> uToken.getUsername();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åŸºäºç”¨æˆ·åæŸ¥è¯¢æ•°æ®åº“ä¸­çš„ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line">        <span class="type">SysUser</span> <span class="variable">user</span> <span class="operator">=</span> sysUserDao.findUserByUserName(username);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// æ ¡éªŒç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnknownAccountException</span>();</span><br><span class="line">        <span class="comment">// æ ¡éªŒç”¨æˆ·æ˜¯å¦å·²è¢«ç¦ç”¨</span></span><br><span class="line">        <span class="keyword">if</span> (user.getValid() == <span class="number">0</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LockedAccountException</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°è£…ç”¨æˆ·ä¿¡æ¯ç”±åº•å±‚è¿›è¡Œå¯†ç æ ¡éªŒ</span></span><br><span class="line">        <span class="type">ByteSource</span> <span class="variable">credentialsSalt</span> <span class="operator">=</span> ByteSource.Util.bytes(user.getSalt());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(user,<span class="comment">//principal èº«ä»½</span></span><br><span class="line">                user.getPassword(),<span class="comment">//hashedCredentials å·²åŠ å¯†çš„å¯†ç </span></span><br><span class="line">                credentialsSalt,<span class="comment">//credentialsSalt å‡­è¯ç›</span></span><br><span class="line">                getName());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŠ å¯†"><a href="#å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŠ å¯†" class="headerlink" title="å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŠ å¯†"></a>å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŠ å¯†</h3><ul>
<li>é‡å†™getCredentialsMatcheræ–¹æ³•æˆ–setCredentialsMatcheræ–¹æ³•å…¶ä¸­ä¸€ä¸ªï¼Œç”¨äºè¿”å›å‡­è¯åŠ å¯†å¯¹è±¡ï¼ŒåŸºäºæ­¤å¯¹è±¡å¯¹ç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒåŠ å¯†æ“ä½œ</li>
</ul>
<h4 id="é‡å†™getCredentialsMatcheræ–¹æ³•"><a href="#é‡å†™getCredentialsMatcheræ–¹æ³•" class="headerlink" title="é‡å†™getCredentialsMatcheræ–¹æ³•"></a>é‡å†™getCredentialsMatcheræ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> CredentialsMatcher <span class="title function_">getCredentialsMatcher</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">HashedCredentialsMatcher</span> <span class="variable">credentialsMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashedCredentialsMatcher</span>();</span><br><span class="line">    <span class="comment">// å®šä¹‰åŠ å¯†ç±»å‹</span></span><br><span class="line">    credentialsMatcher.setHashAlgorithmName(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">    <span class="comment">// å®šä¹‰åŠ å¯†æ¬¡æ•°</span></span><br><span class="line">    credentialsMatcher.setHashIterations(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> credentialsMatcher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é‡å†™getCredentialsMatcheræ–¹æ³•-1"><a href="#é‡å†™getCredentialsMatcheræ–¹æ³•-1" class="headerlink" title="é‡å†™getCredentialsMatcheræ–¹æ³•"></a>é‡å†™getCredentialsMatcheræ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCredentialsMatcher</span><span class="params">(CredentialsMatcher credentialsMatcher)</span> &#123;</span><br><span class="line">    <span class="type">HashedCredentialsMatcher</span> <span class="variable">cMatcher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashedCredentialsMatcher</span>();</span><br><span class="line">    <span class="comment">// å®šä¹‰åŠ å¯†ç±»å‹</span></span><br><span class="line">    cMatcher.setHashAlgorithmName(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">    <span class="comment">// å®šä¹‰åŠ å¯†æ¬¡æ•°</span></span><br><span class="line">    cMatcher.setHashIterations(<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">super</span>.setCredentialsMatcher(cMatcher);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å°†Realmæ·»åŠ åˆ°é…ç½®ç±»"><a href="#å°†Realmæ·»åŠ åˆ°é…ç½®ç±»" class="headerlink" title="å°†Realmæ·»åŠ åˆ°é…ç½®ç±»"></a>å°†Realmæ·»åŠ åˆ°é…ç½®ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">(Realm realm)</span> &#123;</span><br><span class="line">    <span class="type">DefaultWebSecurityManager</span> <span class="variable">sManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">    sManager.setRealm(realm);</span><br><span class="line">    <span class="keyword">return</span> sManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°æˆæƒ"><a href="#å®ç°æˆæƒ" class="headerlink" title="å®ç°æˆæƒ"></a>å®ç°æˆæƒ</h2><h3 id="åœ¨é…ç½®ç±»é…ç½®æˆæƒæ£€æµ‹é¡¾é—®"><a href="#åœ¨é…ç½®ç±»é…ç½®æˆæƒæ£€æµ‹é¡¾é—®" class="headerlink" title="åœ¨é…ç½®ç±»é…ç½®æˆæƒæ£€æµ‹é¡¾é—®"></a>åœ¨é…ç½®ç±»é…ç½®æˆæƒæ£€æµ‹é¡¾é—®</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> AuthorizationAttributeSourceAdvisor <span class="title function_">authorizationAttributeSourceAdvisor</span><span class="params">(SecurityManager securityManager)</span>&#123;</span><br><span class="line">      AuthorizationAttributeSourceAdvisor advisor=<span class="keyword">new</span> <span class="title class_">AuthorizationAttributeSourceAdvisor</span>();</span><br><span class="line">      advisor.setSecurityManager(securityManager);</span><br><span class="line">      <span class="keyword">return</span> advisor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Shiroé…ç½®ç¼“å­˜ï¼ˆCacheï¼‰"><a href="#Shiroé…ç½®ç¼“å­˜ï¼ˆCacheï¼‰" class="headerlink" title="Shiroé…ç½®ç¼“å­˜ï¼ˆCacheï¼‰"></a>Shiroé…ç½®ç¼“å­˜ï¼ˆCacheï¼‰</h2><h3 id="åœ¨é…ç½®ç±»é…ç½®ç¼“å­˜"><a href="#åœ¨é…ç½®ç±»é…ç½®ç¼“å­˜" class="headerlink" title="åœ¨é…ç½®ç±»é…ç½®ç¼“å­˜"></a>åœ¨é…ç½®ç±»é…ç½®ç¼“å­˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> CacheManager <span class="title function_">shiroCacheManager</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MemoryConstrainedCacheManager</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å°†Cacheé…ç½®æ·»åŠ åˆ°æ ¸å¿ƒå¯¹è±¡"><a href="#å°†Cacheé…ç½®æ·»åŠ åˆ°æ ¸å¿ƒå¯¹è±¡" class="headerlink" title="å°†Cacheé…ç½®æ·»åŠ åˆ°æ ¸å¿ƒå¯¹è±¡"></a>å°†Cacheé…ç½®æ·»åŠ åˆ°æ ¸å¿ƒå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">(CacheManager cacheManager)</span> &#123;</span><br><span class="line">    <span class="type">DefaultWebSecurityManager</span> <span class="variable">sManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">    sManager.setCacheManager(cacheManager);</span><br><span class="line">    <span class="keyword">return</span> sManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®ç°è®°ä½æˆ‘"><a href="#å®ç°è®°ä½æˆ‘" class="headerlink" title="å®ç°è®°ä½æˆ‘"></a>å®ç°è®°ä½æˆ‘</h2><h3 id="åœ¨é…ç½®ç±»é…ç½®è®°ä½æˆ‘"><a href="#åœ¨é…ç½®ç±»é…ç½®è®°ä½æˆ‘" class="headerlink" title="åœ¨é…ç½®ç±»é…ç½®è®°ä½æˆ‘"></a>åœ¨é…ç½®ç±»é…ç½®è®°ä½æˆ‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RememberMeManager <span class="title function_">rememberMeManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">CookieRememberMeManager</span> <span class="variable">cManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CookieRememberMeManager</span>();</span><br><span class="line">    SimpleCookie cookie=<span class="keyword">new</span> <span class="title class_">SimpleCookie</span>(<span class="string">&quot;rememberMe&quot;</span>);</span><br><span class="line">    cookie.setMaxAge(<span class="number">7</span>*<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line">    cManager.setCookie(cookie);</span><br><span class="line">    <span class="keyword">return</span> cManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="åœ¨æ ¸å¿ƒå¯¹è±¡é…ç½®è®°ä½æˆ‘"><a href="#åœ¨æ ¸å¿ƒå¯¹è±¡é…ç½®è®°ä½æˆ‘" class="headerlink" title="åœ¨æ ¸å¿ƒå¯¹è±¡é…ç½®è®°ä½æˆ‘"></a>åœ¨æ ¸å¿ƒå¯¹è±¡é…ç½®è®°ä½æˆ‘</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">(RememberMeManager rememberManager)</span> &#123;</span><br><span class="line">    <span class="type">DefaultWebSecurityManager</span> <span class="variable">sManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">    sManager.setRememberMeManager(rememberManager);</span><br><span class="line">    <span class="keyword">return</span> sManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¿®æ”¹è®¿é—®è§„åˆ™"><a href="#ä¿®æ”¹è®¿é—®è§„åˆ™" class="headerlink" title="ä¿®æ”¹è®¿é—®è§„åˆ™"></a>ä¿®æ”¹è®¿é—®è§„åˆ™</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//filterMap.put(&quot;/**&quot;,&quot;authc&quot;);</span></span><br><span class="line">filterMap.put(<span class="string">&quot;/**&quot;</span>,<span class="string">&quot;user&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®ä¼šè¯ï¼ˆSessionï¼‰"><a href="#é…ç½®ä¼šè¯ï¼ˆSessionï¼‰" class="headerlink" title="é…ç½®ä¼šè¯ï¼ˆSessionï¼‰"></a>é…ç½®ä¼šè¯ï¼ˆSessionï¼‰</h2><h3 id="åœ¨é…ç½®ç±»é…ç½®ä¼šè¯"><a href="#åœ¨é…ç½®ç±»é…ç½®ä¼šè¯" class="headerlink" title="åœ¨é…ç½®ç±»é…ç½®ä¼šè¯"></a>åœ¨é…ç½®ç±»é…ç½®ä¼šè¯</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="keyword">public</span> SessionManager <span class="title function_">sessionManager</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">DefaultWebSessionManager</span> <span class="variable">sManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSessionManager</span>();</span><br><span class="line">    sManager.setGlobalSessionTimeout(<span class="number">60</span>*<span class="number">60</span>*<span class="number">1000</span>);</span><br><span class="line">    <span class="keyword">return</span> sManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å°†Sessioné…ç½®æ·»åŠ åˆ°æ ¸å¿ƒé…ç½®å¯¹è±¡"><a href="#å°†Sessioné…ç½®æ·»åŠ åˆ°æ ¸å¿ƒé…ç½®å¯¹è±¡" class="headerlink" title="å°†Sessioné…ç½®æ·»åŠ åˆ°æ ¸å¿ƒé…ç½®å¯¹è±¡"></a>å°†Sessioné…ç½®æ·»åŠ åˆ°æ ¸å¿ƒé…ç½®å¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> SecurityManager <span class="title function_">securityManager</span><span class="params">(SessionManager sessionManager)</span> &#123;</span><br><span class="line">    <span class="type">DefaultWebSecurityManager</span> <span class="variable">sManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>();</span><br><span class="line">    sManager.setSessionManager(sessionManager);</span><br><span class="line">    <span class="keyword">return</span> sManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å®Œæˆ"><a href="#å®Œæˆ" class="headerlink" title="å®Œæˆ"></a>å®Œæˆ</h2>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/Java/">Java</a>
    </span>
    

    </div>

    
  </div>
</article>

  









    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2024 ç»¯é 
    
  </p>
</footer>
    
    
  </div>
</div>
</body>
</html>